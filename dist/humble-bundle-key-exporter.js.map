{"version":3,"file":"humble-bundle-key-exporter.js","sources":["../src/helpers/helpers.js","../src/index.js"],"sourcesContent":["/**\n * @module helpers\n * All the helper functions needed in this project\n */\n\n/**\n * Returns a new Promise that is resolved by a timer for the given milliseconds.\n * @param  { Int } ms - milliseconds\n * @returns { Promise } - a promise that is resolved by a timer\n */\nexport function delayOf(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\n/**\n * Given the data and name, file is downloaded in the browser.\n * @param  { String } data - the file data\n * @param  { String } name - the file name\n */\nexport function downloadFile(data, name) {\n  const a = document.createElement('a')\n  a.href = URL.createObjectURL(new Blob([data]))\n  a.download = name\n  a.click()\n  setTimeout(() => URL.revokeObjectURL(a.href), 500)\n}\n\nexport default {delayOf, downloadFile}\n","import { delayOf, downloadFile } from './helpers/helpers.js'\n\nconst hideRedeemed = async () => {\n  const checkbox = document.getElementById('hide-redeemed')\n  console.log('Hiding redeemed keys.')\n  if (!checkbox.checked) {\n    checkbox.click()\n    await delayOf(250)\n  }\n}\n\nconst setFirstPage = async () => {\n  console.log('Setting first page.')\n  document.querySelector('.js-jump-to-page[data-index=\"0\"]').click()\n  await delayOf(100)\n}\n\nconst getKeysForCurrentPage = () => {\n  return [...document.querySelectorAll('.unredeemed-keys-table tbody tr')].map(row => {\n    return {\n      platform: row.querySelector('.platform :first-child').title.trim(),\n      name: row.querySelector('.game-name h4').textContent.trim().replace(/®|™/g, ''),\n      bundle: row.querySelector('.game-name p').textContent.trim(),\n      bundle_url: row.querySelector('.game-name a').href\n    }\n  })\n}\n\nconst hasNextPage = () => document.querySelector('.js-jump-to-page.current + .js-jump-to-page') !== null\n\nconst setNextPage = async () => {\n  const page = document.querySelector('.js-jump-to-page.current + .js-jump-to-page')\n  if (page !== null) {\n    page.click()\n    await delayOf(100)\n  }\n}\n\nconst getAllKeys = async () => {\n  let data = getKeysForCurrentPage()\n  if (hasNextPage()) {\n    await setNextPage()\n    return data.concat(await getAllKeys())\n  } else {\n    return data\n  }\n}\n\nexport function run() {\n  if (window.location.pathname === '/home/keys') {\n    setFirstPage()\n      .then(hideRedeemed)\n      .then(getAllKeys)\n      .then(data => JSON.stringify(data, null, 2))\n      .then(json => downloadFile(json, 'humble-bundle-keys.json'))\n  } else {\n    console.log(\"No eligible page detected.\")\n  }\n}\n"],"names":["delayOf","ms","Promise","resolve","setTimeout","hideRedeemed","async","checkbox","document","getElementById","console","log","checked","click","setFirstPage","querySelector","getAllKeys","data","querySelectorAll","map","row","platform","title","trim","name","textContent","replace","bundle","bundle_url","href","getKeysForCurrentPage","hasNextPage","page","setNextPage","concat","window","location","pathname","then","JSON","stringify","json","a","createElement","URL","createObjectURL","Blob","download","revokeObjectURL","downloadFile"],"mappings":"qDAUO,SAASA,EAAQC,GACtB,OAAO,IAAIC,QAAQC,GAAWC,WAAWD,EAASF,ICTpD,MAAMI,EAAeC,UACnB,MAAMC,EAAWC,SAASC,eAAe,iBACzCC,QAAQC,IAAI,yBACPJ,EAASK,UACZL,EAASM,cACHb,EAAQ,OAIZc,EAAeR,UACnBI,QAAQC,IAAI,uBACZH,SAASO,cAAc,oCAAoCF,cACrDb,EAAQ,MAwBVgB,EAAaV,UACjB,IAAIW,EAtBwB,KACrB,IAAIT,SAASU,iBAAiB,oCAAoCC,IAAIC,IACpE,CACLC,SAAUD,EAAIL,cAAc,0BAA0BO,MAAMC,OAC5DC,KAAMJ,EAAIL,cAAc,iBAAiBU,YAAYF,OAAOG,QAAQ,OAAQ,IAC5EC,OAAQP,EAAIL,cAAc,gBAAgBU,YAAYF,OACtDK,WAAYR,EAAIL,cAAc,gBAAgBc,QAgBvCC,GACX,MAZkB,KAAgF,OAA1EtB,SAASO,cAAc,+CAY3CgB,SAVczB,WAClB,MAAM0B,EAAOxB,SAASO,cAAc,+CACvB,OAATiB,IACFA,EAAKnB,cACCb,EAAQ,OAORiC,GACChB,EAAKiB,aAAalB,MAElBC,gBAIJ,WAC4B,eAA7BkB,OAAOC,SAASC,SAClBvB,IACGwB,KAAKjC,GACLiC,KAAKtB,GACLsB,KAAKrB,GAAQsB,KAAKC,UAAUvB,EAAM,KAAM,IACxCqB,KAAKG,IDnCL,SAAsBxB,EAAMO,GACjC,MAAMkB,EAAIlC,SAASmC,cAAc,KACjCD,EAAEb,KAAOe,IAAIC,gBAAgB,IAAIC,KAAK,CAAC7B,KACvCyB,EAAEK,SAAWvB,EACbkB,EAAE7B,QACFT,WAAW,IAAMwC,IAAII,gBAAgBN,EAAEb,MAAO,MC8B5BoB,CAAaR,EAAM,4BAEnC/B,QAAQC,IAAI"}