{"version":3,"file":"humble-bundle-key-scraper.js","sources":["../src/helpers/helpers.js","../src/index.js"],"sourcesContent":["/**\n * @module helpers\n * All the helper functions needed in this project\n */\n\n/**\n * Returns a new Promise that is resolved by a timer for the given milliseconds.\n * @param  { Int } ms - milliseconds\n * @returns { Promise } - a promise that is resolved by a timer\n */\nexport function delayOf(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\n/**\n * Given the data and name, file is downloaded in the browser.\n * @param  { String } data - the file data\n * @param  { String } name - the file name\n */\nexport function downloadFile(data, name) {\n  const a = document.createElement('a')\n  a.href = URL.createObjectURL(new Blob([data]))\n  a.download = name\n  a.click()\n  setTimeout(() => URL.revokeObjectURL(a.href), 500)\n}\n\nexport default {delayOf, downloadFile}\n","import { delayOf, downloadFile } from './helpers/helpers.js'\n\nconst hideRedeemed = async () => {\n  const checkbox = document.getElementById('hide-redeemed')\n  console.log('Hiding redeemed keys.')\n  if (!checkbox.checked) {\n    checkbox.click()\n    await delayOf(250)\n  }\n}\n\nconst setFirstPage = async () => {\n  console.log('Setting first page.')\n  document.querySelector('.js-jump-to-page[data-index=\"0\"]').click()\n  await delayOf(100)\n}\n\nconst getKeysForCurrentPage = () => {\n  return [...document.querySelectorAll('.unredeemed-keys-table tbody tr')].map(row => {\n    return {\n      platform: row.querySelector('.platform :first-child').title,\n      name: row.querySelector('.game-name h4').textContent,\n      bundle: row.querySelector('.game-name p').textContent,\n      bundle_url: row.querySelector('.game-name a').href\n    }\n  })\n}\n\nconst hasNextPage = () => document.querySelector('.js-jump-to-page.current + .js-jump-to-page') !== null\n\nconst setNextPage = async () => {\n  const page = document.querySelector('.js-jump-to-page.current + .js-jump-to-page')\n  if (page !== null) {\n    page.click()\n    await delayOf(100)\n  }\n}\n\nconst getAllKeys = async () => {\n  let data = getKeysForCurrentPage()\n  if (hasNextPage()) {\n    await setNextPage()\n    return data.concat(await getAllKeys())\n  } else {\n    return data\n  }\n}\n\nexport function run() {\n  if (window.location.pathname === '/home/keys') {\n    setFirstPage()\n      .then(hideRedeemed)\n      .then(getAllKeys)\n      .then((data) => JSON.stringify(data, null, 2))\n      .then((json) => downloadFile(json, 'humble-bundle-keys.json'))\n  } else {\n    console.log(\"No eligible page detected.\")\n  }\n}\n"],"names":["delayOf","ms","Promise","resolve","setTimeout","hideRedeemed","async","checkbox","document","getElementById","console","log","checked","click","setFirstPage","querySelector","getAllKeys","data","querySelectorAll","map","row","platform","title","name","textContent","bundle","bundle_url","href","getKeysForCurrentPage","hasNextPage","page","setNextPage","concat","window","location","pathname","then","JSON","stringify","json","a","createElement","URL","createObjectURL","Blob","download","revokeObjectURL","downloadFile"],"mappings":"oDAUO,SAASA,EAAQC,GACtB,OAAO,IAAIC,QAASC,GAAYC,WAAWD,EAASF,ICTtD,MAAMI,EAAeC,UACnB,MAAMC,EAAWC,SAASC,eAAe,iBACzCC,QAAQC,IAAI,yBACPJ,EAASK,UACZL,EAASM,cACHb,EAAQ,OAIZc,EAAeR,UACnBI,QAAQC,IAAI,uBACZH,SAASO,cAAc,oCAAoCF,cACrDb,EAAQ,MAwBVgB,EAAaV,UACjB,IAAIW,EAtBwB,KACrB,IAAIT,SAASU,iBAAiB,oCAAoCC,IAAIC,IACpE,CACLC,SAAUD,EAAIL,cAAc,0BAA0BO,MACtDC,KAAMH,EAAIL,cAAc,iBAAiBS,YACzCC,OAAQL,EAAIL,cAAc,gBAAgBS,YAC1CE,WAAYN,EAAIL,cAAc,gBAAgBY,QAgBvCC,GACX,MAZkB,KAAgF,OAA1EpB,SAASO,cAAc,+CAY3Cc,SAVcvB,WAClB,MAAMwB,EAAOtB,SAASO,cAAc,+CACvB,OAATe,IACFA,EAAKjB,cACCb,EAAQ,OAOR+B,GACCd,EAAKe,aAAahB,MAElBC,gBAIJ,WAC4B,eAA7BgB,OAAOC,SAASC,SAClBrB,IACGsB,KAAK/B,GACL+B,KAAKpB,GACLoB,KAAMnB,GAASoB,KAAKC,UAAUrB,EAAM,KAAM,IAC1CmB,KAAMG,IDnCN,SAAsBtB,EAAMM,GACjC,MAAMiB,EAAIhC,SAASiC,cAAc,KACjCD,EAAEb,KAAOe,IAAIC,gBAAgB,IAAIC,KAAK,CAAC3B,KACvCuB,EAAEK,SAAWtB,EACbiB,EAAE3B,QACFT,WAAW,IAAMsC,IAAII,gBAAgBN,EAAEb,MAAO,MC8B1BoB,CAAaR,EAAM,4BAErC7B,QAAQC,IAAI"}